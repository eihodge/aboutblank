<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>about:blank popup with iframe test</title>
</head>
<body>
  <h1>about:blank popup with iframe</h1>

  <button id="openPopupBtn">Open about:blank popup</button>

  <script>
    document.getElementById("openPopupBtn").addEventListener("click", function () {
      const popup = window.open(
        "about:blank",
        "blankPopupWithIframe",
        "width=600,height=400"
      );

      if (!popup) {
        alert("Popup blocked");
        return;
      }

      popup.document.write(`
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <title>about:blank popup</title>
        </head>
        <body>
          <h2>about:blank popup outer window</h2>

          <iframe id="innerFrame" style="width:100%;height:70%;border:1px solid #ccc;"></iframe>
        </body>
        </html>
      `);
      popup.document.close();

      const iframe = popup.document.getElementById("innerFrame");
      const frameDoc = iframe.contentWindow.document;

      frameDoc.open();
      frameDoc.write(`
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <title>Inner iframe</title>
        </head>
        <body>
          <h3>Inner iframe</h3>
          <button id="closeBtn">Close popup</button>

          <script>
            document.getElementById('closeBtn').addEventListener('click', function () {
              window.top.close();
            });
          <\/script>
        </body>
        </html>
      `);
      frameDoc.close();
    });
  </script>
</body>
</html>
